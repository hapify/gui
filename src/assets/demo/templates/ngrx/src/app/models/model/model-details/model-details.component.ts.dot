import {Component, EventEmitter, Input, Output, OnInit} from '@angular/core';
import {MatSlideToggleChange} from '@angular/material';
import {ErrorService} from '@app/messages';
import {{{=it.m.names.upperCamel}}} from '../{{=it.m.names.hyphen}}';
import {{{=it.m.names.upperCamel}}Service} from '../{{=it.m.names.hyphen}}.service';

@Component({
  selector: 'anms-{{=it.m.names.hyphen}}-details',
  templateUrl: './{{=it.m.names.hyphen}}-details.component.html',
  styleUrls: ['./{{=it.m.names.hyphen}}-details.component.scss']
})
export class {{=it.m.names.upperCamel}}DetailsComponent implements OnInit {

  /**
   * The {{=it.m.names.wordsLower}} to inject in the form
   */
  @Input() {{=it.m.names.lowerCamel}}: {{=it.m.names.upperCamel}};

  /**
   * Called the save button is clicked
   *
   * @type {EventEmitter<void>}
   */
  @Output() onDelete = new EventEmitter<void>();

  /**
   * Toggle delete button display
   *
   * @type {boolean}
   */
  deletionUnlocked: boolean = false;

  /**
   * Constructor
   *
   * @param {{{=it.m.names.upperCamel}}Service} {{=it.m.names.lowerCamel}}Service
   * @param {ErrorService} errorService
   */
  constructor(private {{=it.m.names.lowerCamel}}Service: {{=it.m.names.upperCamel}}Service,
              private errorService: ErrorService) {
  }

  /**
   * Init
   */
  ngOnInit() {
  }

  /**
   * Triggered when the lock is moved
   *
   * @param {MatSlideToggleChange} event
   */
  onDeletionUnlock(event: MatSlideToggleChange): void {
    this.deletionUnlocked = event.checked;
  }

  /**
   * Called on deletion
   */
  onDeleteClick(): void {
    this.{{=it.m.names.lowerCamel}}Service.remove(this.{{=it.m.names.lowerCamel}}.getId())
      .then(() => {
        this.onDelete.next();
      })
      .catch((error) => this.errorService.handle(error));
  }
}
