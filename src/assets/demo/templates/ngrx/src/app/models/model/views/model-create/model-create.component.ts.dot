import {Component, OnInit} from '@angular/core';
import {Router} from '@angular/router';
import {ErrorService} from '@app/messages';
import {{{=it.m.names.upperCamel}}} from '../../{{=it.m.names.hyphen}}';
import {{{=it.m.names.upperCamel}}Service} from '../../{{=it.m.names.hyphen}}.service';

@Component({
  selector: 'anms-{{=it.m.names.hyphen}}-create',
  templateUrl: './{{=it.m.names.hyphen}}-create.component.html',
  styleUrls: ['./{{=it.m.names.hyphen}}-create.component.scss']
})
export class {{=it.m.names.upperCamel}}CreateComponent implements OnInit {

  /**
   * A new {{=it.m.names.wordsLower}}
   *
   * @type {{{=it.m.names.upperCamel}}}
   */
  {{=it.m.names.lowerCamel}}: {{=it.m.names.upperCamel}};

  /**
   * Constructor
   *
   * @param {Router} router
   * @param {ErrorService} errorService
   * @param {{{=it.m.names.upperCamel}}Service} {{=it.m.names.lowerCamel}}Service
   */
  constructor(private router: Router,
              private errorService: ErrorService,
              private {{=it.m.names.lowerCamel}}Service: {{=it.m.names.upperCamel}}Service) {
  }

  /**
   * Init
   */
  ngOnInit() {
    // Create a new {{=it.m.names.wordsLower}}
    this.{{=it.m.names.lowerCamel}} = new {{=it.m.names.upperCamel}}();
  }

  /**
   * Called when the {{=it.m.names.wordsLower}} is saved
   */
  on{{=it.m.names.upperCamel}}Save(): void {
    const props = this.{{=it.m.names.lowerCamel}}.toObject();
    this.{{=it.m.names.lowerCamel}}Service.create({{{~it.m.f.l : f}}{{? !f.internal }}
      {{=f.names.underscore}}: {{?f.type==='datetime'}}<number>{{?}}props.{{=f.names.underscore}},{{?}}{{~}}
    })
      .then(({{=it.m.names.lowerCamel}}: {{=it.m.names.upperCamel}}) => {
        this.router.navigateByUrl(`/{{=it.m.names.hyphen}}/${{{=it.m.names.lowerCamel}}.getId()}`);
      })
      .catch((error) => this.errorService.handle(error));
  }

}
