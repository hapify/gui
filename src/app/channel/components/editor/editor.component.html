<div class="editor d-flex flex-column align-items-stretch">
	<header>
		<nav class="navbar navbar-expand-lg navbar-dark bg-dark">
			<div class="collapse navbar-collapse">
				<div class="navbar-nav mr-auto">
					<div class="navbar-brand name">{{ template.name }}</div>
					<select
						*ngIf="template.needsModel()"
						[(ngModel)]="model"
						(change)="onModelChange()"
					>
						<option
							*ngFor="let model of models"
							[ngValue]="model"
							>{{ model.name }}</option
						>
					</select>
					<div class="btn-group ml-2" data-toggle="buttons">
						<label
							class="btn"
							title="{{
								'channels_tooltip_autorefresh' | translate
							}}"
							[ngClass]="{
								'btn-light': autoGenerate,
								'btn-outline-light': !autoGenerate
							}"
						>
							<input
								type="checkbox"
								autocomplete="off"
								[(ngModel)]="autoGenerate"
							/>
							<span class="oi oi-eye"></span>
						</label>
					</div>
					<div class="btn-group ml-2" data-toggle="buttons">
						<label
							class="btn"
							title="{{
								'channels_tooltip_autogenerate' | translate
							}}"
							[ngClass]="{
								'btn-light': generatorService.autoSyncEnabled,
								'btn-outline-light': !generatorService.autoSyncEnabled
							}"
						>
							<input
								type="checkbox"
								autocomplete="off"
								[(ngModel)]="generatorService.autoSyncEnabled"
							/>
							<span class="oi oi-reload"></span>
						</label>
					</div>
				</div>
				<button
					type="button"
					class="btn btn-outline-light d-none"
					(click)="didClickDump()"
					title="{{ 'channels_tooltip_dump' | translate }}"
				>
					<span class="oi oi-code"></span>
				</button>
				<button
					type="button"
					class="btn btn-outline-light ml-4"
					(click)="didClickClose()"
				>
					{{ 'common_close' | translate }}
				</button>
				<button
					type="button"
					class="btn ml-2"
					[ngClass]="{
						'btn-outline-light': !unsavedChanges,
						'btn-light': unsavedChanges
					}"
					(click)="didClickSave()"
				>
					{{ 'common_save' | translate }}
				</button>
			</div>
		</nav>
	</header>
	<div class="d-flex grow">
		<div class="col-lg-6 input d-flex flex-column p-3">
			<div>
				<div class="input-cnt">
					<input
						type="text"
						[value]="wip.path"
						(blur)="onPathChange($event.target.value)"
					/>
				</div>
			</div>
			<ace-editor
				class="mt-3 p-3 rounded code grow bg-light input-editor"
				#editorInput
				[(text)]="wip.content"
				[mode]="aceService.mode(wip.aceMode(), false)"
				[theme]="aceService.theme()"
				[options]="{}"
				[readOnly]="false"
				[autoUpdateContent]="true"
				[durationBeforeCallback]="1000"
				(textChanged)="onChange($event)"
			></ace-editor>
		</div>
		<div class="col-lg-6 output d-flex flex-column p-3">
			<input
				*ngIf="!template.needsModel() || !!model"
				readonly
				[value]="pathResult"
				type="text"
			/>
			<ace-editor
				*ngIf="result"
				class="mt-3 p-3 rounded code grow bg-light"
				[(text)]="result.content"
				[mode]="aceService.mode(wip.path)"
				[theme]="aceService.theme()"
				[options]="{ printMargin: false }"
				[readOnly]="true"
				[autoUpdateContent]="true"
			></ace-editor>
			<div *ngIf="error">
				<div class="mt-3 rounded alert alert-danger small">
					<pre class="m-0 p-2">{{ error }}</pre>
				</div>
			</div>
		</div>
	</div>
</div>
