<div class="editor d-flex flex-column align-items-stretch">
    <header>
        <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
            <div class="collapse navbar-collapse">
                <div class="navbar-nav mr-auto">
                    <div class="navbar-brand name">{{ template.name }}</div>
                    <select *ngIf="template.needsModel()"
                            [(ngModel)]="model"
                            class="form-control"
                            (change)="onModelChange();">
                        <option *ngFor="let model of models" [ngValue]="model">{{model.name}}</option>
                    </select>
                    <div class="btn-group ml-2" data-toggle="buttons">
                        <label class="btn" title="{{ 'channels_tooltip_autogenerate' | translate }}"
                               [ngClass]="{ 'btn-light': autoGenerate, 'btn-outline-light': !autoGenerate }">
                            <input type="checkbox" autocomplete="off" [(ngModel)]="autoGenerate">
                            <span class="oi oi-reload"></span>
                        </label>
                    </div>
                </div>
                <button type="button" class="btn btn-outline-light" (click)="didClickDump();"
                        title="{{ 'channels_tooltip_dump' | translate }}">
                    <span class="oi oi-code"></span>
                </button>
                <button type="button" class="btn btn-outline-light ml-4" (click)="didClickCancel();">{{ 'common_cancel'
                    | translate }}
                </button>
                <button type="button" class="btn btn-light ml-2" [disabled]="form.invalid" (click)="didClickSave();">{{
                    'common_save' | translate }}
                </button>
            </div>
        </nav>
    </header>
    <div class="d-flex grow">
        <div class="col-lg-6 input d-flex flex-column p-3">
            <div [formGroup]="form">
                <div class="input-cnt">
                    <input formControlName="path" class="form-control" [(ngModel)]="wip.path" type="text">
                    <div
                            *ngIf="form.controls['path'].invalid && (form.controls['path'].dirty || form.controls['path'].touched)"
                            class="alert alert-danger mt-2">
                        <div *ngIf="form.controls['path'].errors.required">
                            {{ 'error_path_required' | translate }}
                        </div>
                        <div *ngIf="form.controls['path'].errors.pattern && !form.controls['path'].errors.required">
                            {{ 'error_path_format' | translate }}
                        </div>
                        <div *ngIf="form.controls['path'].errors.minlength">
                            {{ 'error_path_min_length' | translate:translateParams }}
                        </div>
                        <div *ngIf="form.controls['path'].errors.maxlength">
                            {{ 'error_path_max_length' | translate:translateParams }}
                        </div>
                    </div>
                </div>
            </div>
            <div class="mt-3 p-3 rounded code grow bg-light input-editor"
                 ace-editor
                 [(text)]="wip.content"
                 [mode]="aceService.mode(wip.aceMode(), false)"
                 [theme]="aceService.theme()"
                 [options]="{}"
                 [readOnly]="false"
                 [autoUpdateContent]="true"
                 [durationBeforeCallback]="1000"
                 (textChanged)="onChange($event)"></div>
        </div>
        <div class="col-lg-6 output d-flex flex-column p-3">
            <input *ngIf="!template.needsModel() || model"
                   class="form-control"
                   readonly
                   [value]="generatorService.path(wip, model)"
                   type="text">
            <div *ngIf="result" class="mt-3 p-3 rounded code grow bg-light"
                 ace-editor
                 [(text)]="result.content"
                 [mode]="aceService.mode(wip.path)"
                 [theme]="aceService.theme()"
                 [options]="{printMargin: false}"
                 [readOnly]="true"
                 [autoUpdateContent]="true"></div>
            <div *ngIf="error">
                <div class="mt-3 rounded alert alert-danger small">
                    <pre class="m-0 p-2">{{ error }}</pre>
                </div>
            </div>
        </div>
    </div>
</div>
